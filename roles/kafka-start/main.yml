- name: Wait for ZooKeeper to be up (self)
  wait_for:
    host: "{{ hostvars[inventory_hostname].private_ip }}"
    port: 2181
    state: started
    delay: 5
    timeout: 60

- name: Wait for ZooKeeper peers to be up
  wait_for:
    host: "{{ hostvars[item].private_ip }}"
    port: 2181
    state: started
    timeout: 60
  loop: "{{ groups['all'] | difference([inventory_hostname]) }}"
  when: hostvars[item].private_ip is defined
  delegate_to: "{{ inventory_hostname }}"
  become: false

    
- name: Configure and start Kafka using systemd
  include_tasks: systemd.yml


- name: Wait for Kafka broker to be up
  wait_for:
    host: "{{ hostvars[inventory_hostname].private_ip }}"
    port: 9092
    state: started
    delay: 5
    timeout: 90
